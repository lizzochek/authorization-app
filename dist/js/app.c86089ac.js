(function(){"use strict";var e={4979:function(e,t,i){var n=i(9242),r=i(3396);function a(e,t,i,a,s,o){const d=(0,r.up)("router-view");return(0,r.wg)(),(0,r.j4)(d,null,{default:(0,r.w5)((({Component:e})=>[(0,r.Wm)(n.uT,{name:"fade"},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)((0,r.LL)(e)))])),_:2},1024)])),_:1})}var s={name:"App"},o=i(89);const d=(0,o.Z)(s,[["render",a]]);var l=d,u=i(65),c=(0,u.MT)({state:{users:[],curUser:{},isLoggedIn:!1,isAdmin:!1},getters:{getUsers(e){return e.users},getCurUser(e){return e.curUser},isLoggedIn(e){return e.isLoggedIn},isAdmin(e){return e.isAdmin}},mutations:{async fetchAllUsers(e){const t=await fetch("/api/users"),i=await t.json();e.users=i},async createUser(e,t){const i=await fetch("/api/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})});return await i.json()},async getCurrentUser(e,t){const i=e.users.find((e=>e.email===t));this.state.curUser=i},async removeUser(e,t){await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})})},async giveAdminRights(e,t){await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})})},setCurrentUser(e,t){e.curUser=t},setAuthentication(e,{isLoggedIn:t,admin:i}){e.isLoggedIn=t,e.isAdmin=i}},actions:{fetchAllUsers({commit:e}){e("fetchAllUsers")},createUser({commit:e},t){e("createUser",t)},getCurrentUser({commit:e},t){e("getCurrentUser",t)},setCurrentUser({commit:e},t){e("setCurrentUser",t)},giveAdminRights({commit:e},t){e("giveAdminRights",t),e("fetchAllUsers")},removeUser({commit:e},t){e("removeUser",t),e("fetchAllUsers")},setAuthentication({commit:e},{isLoggedIn:t,admin:i}){e("setAuthentication",{isLoggedIn:t,admin:i})}}}),h=i(2483),p=i(7139);const m=e=>((0,r.dD)("data-v-f65fa2fc"),e=e(),(0,r.Cn)(),e),g=m((()=>(0,r._)("h1",null,"User list",-1))),f={id:"container"},v={key:"email",id:"card"},w={key:0},y=["onClick"],U=["onClick"];function I(e,t,i,n,a,s){return(0,r.wg)(),(0,r.iD)(r.HY,null,[g,(0,r._)("div",f,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.users,(e=>((0,r.wg)(),(0,r.iD)("div",v,[(0,r._)("p",null,"Name: "+(0,p.zw)(e.userInfo.name),1),(0,r._)("p",null,"Group: "+(0,p.zw)(e.userInfo.group),1),(0,r._)("p",null,"Phone: "+(0,p.zw)(e.userInfo.phone),1),(0,r._)("p",null,"ID card: "+(0,p.zw)(e.userInfo.idCard),1),(0,r._)("p",null,"Faculty: "+(0,p.zw)(e.userInfo.faculty),1),e.admin?((0,r.wg)(),(0,r.iD)("p",w,"Admin")):(0,r.kq)("",!0),e.admin?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("button",{key:1,onClick:t=>s.giveAdminRights(e.email)}," Give admin rights ",8,y)),e.admin?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("button",{key:2,onClick:t=>s.deleteUser(e.email)}," Delete user ",8,U))])))),128))])],64)}var k={name:"UserList",computed:{users(){return this.$store.getters.getUsers}},created(){this.$store.dispatch("fetchAllUsers")},methods:{deleteUser(e){this.$store.dispatch("removeUser",e)},giveAdminRights(e){this.$store.dispatch("giveAdminRights",e)}}};const A=(0,o.Z)(k,[["render",I],["__scopeId","data-v-f65fa2fc"]]);var _=A;const C=e=>((0,r.dD)("data-v-005a4132"),e=e(),(0,r.Cn)(),e),b=C((()=>(0,r._)("h1",null,"Your Info",-1))),L={key:0,id:"card"};function D(e,t,i,n,a,s){return(0,r.wg)(),(0,r.iD)(r.HY,null,[b,a.info?((0,r.wg)(),(0,r.iD)("div",L,[(0,r._)("p",null,"Name: "+(0,p.zw)(a.info.name),1),(0,r._)("p",null,"Group: "+(0,p.zw)(a.info.group),1),(0,r._)("p",null,"Phone: "+(0,p.zw)(a.info.phone),1),(0,r._)("p",null,"ID card: "+(0,p.zw)(a.info.idCard),1),(0,r._)("p",null,"Faculty: "+(0,p.zw)(a.info.faculty),1)])):(0,r.kq)("",!0)],64)}var O={name:"UserInfo",data(){return{info:void 0}},created(){const e=this.$store.getters.getCurUser;this.info=e.userInfo}};const P=(0,o.Z)(O,[["render",D],["__scopeId","data-v-005a4132"]]);var $=P;const q=e=>((0,r.dD)("data-v-25a6e137"),e=e(),(0,r.Cn)(),e),j={class:"title"},z={key:0},x={key:1},R={key:0},S={key:1},T={key:2,id:"usr-data"},F={key:0},M={key:1},V={key:2},Z={key:3},N={key:4},Y=q((()=>(0,r._)("button",{type:"submit"},"Submit",-1))),G={id:"register-link"},H=q((()=>(0,r._)("p",null,"Don't have an account?",-1)));function J(e,t,i,a,s,o){return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("div",j,[s.registrationMode?((0,r.wg)(),(0,r.iD)("h2",x,"Register now!")):((0,r.wg)(),(0,r.iD)("h2",z,"Authorize!"))]),(0,r._)("form",{onSubmit:t[8]||(t[8]=(...e)=>o.onFormSubmit&&o.onFormSubmit(...e))},[(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Login","onUpdate:modelValue":t[0]||(t[0]=e=>s.email=e),class:(0,p.C_)(e.emailInvalid?"invalid":"")},null,2),[[n.nr,s.email]]),s.validation.emailInvalid?((0,r.wg)(),(0,r.iD)("p",R,"Please enter a valid email")):(0,r.kq)("",!0),(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Password","onUpdate:modelValue":t[1]||(t[1]=e=>s.password=e),class:(0,p.C_)(e.passwordInvalid?"invalid":"")},null,2),[[n.nr,s.password]]),s.validation.passwordInvalid?((0,r.wg)(),(0,r.iD)("p",S," Password has to be at least 8 characters long ")):(0,r.kq)("",!0),s.registrationMode?((0,r.wg)(),(0,r.iD)("div",T,[(0,r.wy)((0,r._)("input",{type:"text",id:"top",placeholder:"Full name","onUpdate:modelValue":t[2]||(t[2]=e=>s.name=e)},null,512),[[n.nr,s.name]]),s.validation.nameInvalid?((0,r.wg)(),(0,r.iD)("p",F," Please enter full name in the format: Word L.L. ")):(0,r.kq)("",!0),(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Group","onUpdate:modelValue":t[3]||(t[3]=e=>s.group=e)},null,512),[[n.nr,s.group]]),s.validation.groupInvalid?((0,r.wg)(),(0,r.iD)("p",M," Please enter group in the format: LL-11 ")):(0,r.kq)("",!0),(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Phone number","onUpdate:modelValue":t[4]||(t[4]=e=>s.phone=e)},null,512),[[n.nr,s.phone]]),s.validation.phoneInvalid?((0,r.wg)(),(0,r.iD)("p",V," Please enter phone number in the format: (111)-111-11-11 ")):(0,r.kq)("",!0),(0,r.wy)((0,r._)("input",{type:"text",placeholder:"ID card","onUpdate:modelValue":t[5]||(t[5]=e=>s.idCard=e)},null,512),[[n.nr,s.idCard]]),s.validation.idInvalid?((0,r.wg)(),(0,r.iD)("p",Z," Please enter id in the format: LL №111111 ")):(0,r.kq)("",!0),(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Faculty","onUpdate:modelValue":t[6]||(t[6]=e=>s.faculty=e)},null,512),[[n.nr,s.faculty]]),s.validation.facultyInvalid?((0,r.wg)(),(0,r.iD)("p",N," Please enter faculty in the format: LLLL ")):(0,r.kq)("",!0)])):(0,r.kq)("",!0),Y,(0,r._)("div",G,[H,(0,r._)("p",{id:"link",onClick:t[7]||(t[7]=(...e)=>o.toggleRegistation&&o.toggleRegistation(...e))}," Register now? ")])],32)])}i(7658);var E=i(3495),W=i.n(E),K={name:"Login",data(){return{hasAccess:!1,registrationMode:!1,email:"",password:"",name:"",group:"",phone:"",idCard:"",faculty:"",validation:{emailInvalid:!1,passwordInvalid:!1,nameInvalid:!1,groupInvalid:!1,phoneInvalid:!1,idInvalid:!1,facultyInvalid:!1}}},computed:{users(){return this.$store.getters.getUsers},currentUser(){return this.$store.getters.getCurUser}},methods:{toggleRegistation(){this.registrationMode=!this.registrationMode,this.clearValidation()},clearValidation(){Object.keys(this.validation).map((e=>this.validation[e]=!1))},onFormSubmit(e){e.preventDefault(),this.clearValidation();const t=this.validateForm();t&&(this.registrationMode?this.onRegister():this.onLogin())},validateForm(){-1===this.email.search(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g)&&(this.validation.emailInvalid=!0),this.password.length<8&&(this.validation.passwordInvalid=!0),this.registrationMode&&(-1===this.name.search(/\w+\s+[A-Z]\.+[A-Z]\./)&&(this.validation.nameInvalid=!0),-1===this.group.search(/[A-za-z][A-za-z]+\-+[0-9][0-9]/)&&(this.validation.groupInvalid=!0),-1===this.phone.search(/((\(\d{3}\) ?)|(\d{3}-))?\-\d{3}-\d{2}-\d{2}/)&&(this.validation.phoneInvalid=!0),-1===this.idCard.search(/[A-Z][A-Z]+\s+\№\d{6}/)&&(this.validation.idInvalid=!0),-1===this.faculty.search(/[A-Z]{4}/)&&(this.validation.facultyInvalid=!0));const e=Object.values(this.validation).findIndex((e=>!0===e));return!(e>=0)},onLogin(){if(this.$store.dispatch("getCurrentUser",this.email),!this.currentUser)return void W()("There is no user with such email. Please register instead");const{password:e,admin:t,userInfo:i}=this.currentUser;e==this.password?(this.$store.dispatch("setAuthentication",{isLoggedIn:!0,admin:t}),t?this.$router.push("/users"):this.$router.push("/info")):W()("Your email or password is wrong. Please try again")},async onRegister(){this.$store.dispatch("getCurrentUser",this.email);const e=this.$store.getters.getCurUser;if(e)return W()("User with this email already exists. Please log in instead"),void(this.registrationMode=!1);const t={email:this.email,password:this.password,admin:!1,userInfo:{name:this.name,group:this.group,phone:this.phone,idCard:this.idCard,faculty:this.faculty}};this.$store.dispatch("createUser",t),this.$store.dispatch("setCurrentUser",t),this.$store.dispatch("setAuthentication",{isLoggedIn:!0,admin:!1}),this.$router.push("/info")}},mounted(){this.$store.dispatch("fetchAllUsers")}};const B=(0,o.Z)(K,[["render",J],["__scopeId","data-v-25a6e137"]]);var Q=B;const X=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:Q},{path:"/users",name:"UserList",component:_,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/info",name:"UserInfo",component:$,props:!0,meta:{requiresAuth:!0}}],ee=(0,h.p7)({history:(0,h.PO)(),routes:X});ee.beforeEach(((e,t,i)=>{e.meta.requiresAuth&&!c.getters.isLoggedIn?i("/login"):e.meta.requiresAdmin&&c.getters.isLoggedIn&&!c.getters.isAdmin?(W()("Sorry, you do not have admin rights!"),i("/info")):i()}));var te=ee;(0,n.ri)(l).use(c).use(te).mount("#app")}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,n,r,a){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],r=e[u][1],a=e[u][2];for(var o=!0,d=0;d<n.length;d++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[d])}))?n.splice(d--,1):(o=!1,a<s&&(s=a));if(o){e.splice(u--,1);var l=r();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,r,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,a,s=n[0],o=n[1],d=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(d)var u=d(i)}for(t&&t(n);l<s.length;l++)a=s[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(u)},n=self["webpackChunkui"]=self["webpackChunkui"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(4979)}));n=i.O(n)})();
//# sourceMappingURL=app.c86089ac.js.map