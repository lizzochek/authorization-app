(function(){"use strict";var e={8660:function(e,t,i){var n=i(9242),s=i(3396);function r(e,t,i,r,a,o){const d=(0,s.up)("router-view");return(0,s.wg)(),(0,s.j4)(d,null,{default:(0,s.w5)((({Component:e})=>[(0,s.Wm)(n.uT,{name:"fade"},{default:(0,s.w5)((()=>[((0,s.wg)(),(0,s.j4)((0,s.LL)(e)))])),_:2},1024)])),_:1})}var a={name:"App"},o=i(89);const d=(0,o.Z)(a,[["render",r]]);var l=d,u=i(65),c=(0,u.MT)({state:{users:[],curUser:{},isLoggedIn:!1,isAdmin:!1},getters:{getUsers(e){return e.users},getCurUser(e){return e.curUser},isLoggedIn(e){return e.isLoggedIn},isAdmin(e){return e.isAdmin}},mutations:{async fetchAllUsers(e){const t=await fetch("/api/users"),i=await t.json();e.users=i},async createUser(e,t){const i=await fetch("/api/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})});return await i.json()},async getCurrentUser(e,t){const i=e.users.find((e=>e.email===t));this.state.curUser=i},async removeUser(e,t){await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})})},async giveAdminRights(e,t){await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})})},async changePassword(e,{email:t,password:i}){e.curUser.password=i,await fetch("/api/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:i})})},setCurrentUser(e,t){e.curUser=t},setAuthentication(e,{isLoggedIn:t,admin:i}){e.isLoggedIn=t,e.isAdmin=i}},actions:{fetchAllUsers({commit:e}){e("fetchAllUsers")},createUser({commit:e},t){e("createUser",t)},getCurrentUser({commit:e},t){e("getCurrentUser",t)},setCurrentUser({commit:e},t){e("setCurrentUser",t)},giveAdminRights({commit:e},t){e("giveAdminRights",t),e("fetchAllUsers")},removeUser({commit:e},t){e("removeUser",t),e("fetchAllUsers")},setAuthentication({commit:e},{isLoggedIn:t,admin:i}){e("setAuthentication",{isLoggedIn:t,admin:i})},changePassword({commit:e},{email:t,password:i}){e("changePassword",{email:t,password:i})}}}),h=i(2483),p=i(7139);const m=e=>((0,s.dD)("data-v-f65fa2fc"),e=e(),(0,s.Cn)(),e),g=m((()=>(0,s._)("h1",null,"User list",-1))),w={id:"container"},f={key:"email",id:"card"},v={key:0},y=["onClick"],U=["onClick"];function I(e,t,i,n,r,a){return(0,s.wg)(),(0,s.iD)(s.HY,null,[g,(0,s._)("div",w,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.users,(e=>((0,s.wg)(),(0,s.iD)("div",f,[(0,s._)("p",null,"Name: "+(0,p.zw)(e.userInfo.name),1),(0,s._)("p",null,"Group: "+(0,p.zw)(e.userInfo.group),1),(0,s._)("p",null,"Phone: "+(0,p.zw)(e.userInfo.phone),1),(0,s._)("p",null,"ID card: "+(0,p.zw)(e.userInfo.idCard),1),(0,s._)("p",null,"Faculty: "+(0,p.zw)(e.userInfo.faculty),1),e.admin?((0,s.wg)(),(0,s.iD)("p",v,"Admin")):(0,s.kq)("",!0),e.admin?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("button",{key:1,onClick:t=>a.giveAdminRights(e.email)}," Give admin rights ",8,y)),e.admin?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("button",{key:2,onClick:t=>a.deleteUser(e.email)}," Delete user ",8,U))])))),128))])],64)}var _={name:"UserList",computed:{users(){return this.$store.getters.getUsers}},created(){this.$store.dispatch("fetchAllUsers")},methods:{deleteUser(e){this.$store.dispatch("removeUser",e)},giveAdminRights(e){this.$store.dispatch("giveAdminRights",e)}}};const k=(0,o.Z)(_,[["render",I],["__scopeId","data-v-f65fa2fc"]]);var C=k;const b=e=>((0,s.dD)("data-v-e52a3160"),e=e(),(0,s.Cn)(),e),A=b((()=>(0,s._)("h1",null,"Your Info",-1))),P={id:"container"},D={key:0,id:"card"};function L(e,t,i,n,r,a){const o=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)(s.HY,null,[A,(0,s._)("div",P,[r.info?((0,s.wg)(),(0,s.iD)("div",D,[(0,s._)("p",null,"Name: "+(0,p.zw)(r.info.name),1),(0,s._)("p",null,"Group: "+(0,p.zw)(r.info.group),1),(0,s._)("p",null,"Phone: "+(0,p.zw)(r.info.phone),1),(0,s._)("p",null,"ID card: "+(0,p.zw)(r.info.idCard),1),(0,s._)("p",null,"Faculty: "+(0,p.zw)(r.info.faculty),1)])):(0,s.kq)("",!0),(0,s.Wm)(o,{to:"/edit",id:"link"},{default:(0,s.w5)((()=>[(0,s.Uk)("Change password")])),_:1})])],64)}var O={name:"UserInfo",data(){return{info:void 0}},created(){const e=this.$store.getters.getCurUser;this.info=e.userInfo}};const $=(0,o.Z)(O,[["render",L],["__scopeId","data-v-e52a3160"]]);var q=$;const S=e=>((0,s.dD)("data-v-93173088"),e=e(),(0,s.Cn)(),e),j={class:"title"},x={key:0},z={key:1},F={key:0},R={key:1},T={key:2,id:"usr-data"},V={key:0},M={key:1},Z={key:2},N={key:3},Y={key:4},G=S((()=>(0,s._)("button",{type:"submit"},"Submit",-1))),E={id:"register-link"},J=S((()=>(0,s._)("p",null,"Don't have an account?",-1)));function H(e,t,i,r,a,o){return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",j,[a.registrationMode?((0,s.wg)(),(0,s.iD)("h2",z,"Register now!")):((0,s.wg)(),(0,s.iD)("h2",x,"Authorize!"))]),(0,s._)("form",{onSubmit:t[8]||(t[8]=(...e)=>o.onFormSubmit&&o.onFormSubmit(...e))},[(0,s.wy)((0,s._)("input",{type:"text",placeholder:"Login","onUpdate:modelValue":t[0]||(t[0]=e=>a.email=e),class:(0,p.C_)(e.emailInvalid?"invalid":"")},null,2),[[n.nr,a.email]]),a.validation.emailInvalid?((0,s.wg)(),(0,s.iD)("p",F,"Please enter a valid email")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{type:"text",placeholder:"Password","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e),class:(0,p.C_)(e.passwordInvalid?"invalid":"")},null,2),[[n.nr,a.password]]),a.validation.passwordInvalid?((0,s.wg)(),(0,s.iD)("p",R," Password has to be at least 8 characters long ")):(0,s.kq)("",!0),a.registrationMode?((0,s.wg)(),(0,s.iD)("div",T,[(0,s.wy)((0,s._)("input",{type:"text",id:"top",placeholder:"Full name","onUpdate:modelValue":t[2]||(t[2]=e=>a.name=e)},null,512),[[n.nr,a.name]]),a.validation.nameInvalid?((0,s.wg)(),(0,s.iD)("p",V," Please enter full name in the format: Word L.L. ")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{type:"text",placeholder:"Group","onUpdate:modelValue":t[3]||(t[3]=e=>a.group=e)},null,512),[[n.nr,a.group]]),a.validation.groupInvalid?((0,s.wg)(),(0,s.iD)("p",M," Please enter group in the format: LL-11 ")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{type:"text",placeholder:"Phone number","onUpdate:modelValue":t[4]||(t[4]=e=>a.phone=e)},null,512),[[n.nr,a.phone]]),a.validation.phoneInvalid?((0,s.wg)(),(0,s.iD)("p",Z," Please enter phone number in the format: (111)-111-11-11 ")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{type:"text",placeholder:"ID card","onUpdate:modelValue":t[5]||(t[5]=e=>a.idCard=e)},null,512),[[n.nr,a.idCard]]),a.validation.idInvalid?((0,s.wg)(),(0,s.iD)("p",N," Please enter id in the format: LL №111111 ")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{type:"text",placeholder:"Faculty","onUpdate:modelValue":t[6]||(t[6]=e=>a.faculty=e)},null,512),[[n.nr,a.faculty]]),a.validation.facultyInvalid?((0,s.wg)(),(0,s.iD)("p",Y," Please enter faculty in the format: LLLL ")):(0,s.kq)("",!0)])):(0,s.kq)("",!0),G,(0,s._)("div",E,[J,(0,s._)("p",{id:"link",onClick:t[7]||(t[7]=(...e)=>o.toggleRegistation&&o.toggleRegistation(...e))}," Register now? ")])],32)])}i(7658);var W=i(3495),K=i.n(W),B={name:"Login",data(){return{hasAccess:!1,registrationMode:!1,email:"",password:"",name:"",group:"",phone:"",idCard:"",faculty:"",validation:{emailInvalid:!1,passwordInvalid:!1,nameInvalid:!1,groupInvalid:!1,phoneInvalid:!1,idInvalid:!1,facultyInvalid:!1}}},computed:{users(){return this.$store.getters.getUsers},currentUser(){return this.$store.getters.getCurUser}},methods:{toggleRegistation(){this.registrationMode=!this.registrationMode,this.clearValidation()},clearValidation(){Object.keys(this.validation).map((e=>this.validation[e]=!1))},onFormSubmit(e){e.preventDefault(),this.clearValidation();const t=this.validateForm();t&&(this.registrationMode?this.onRegister():this.onLogin())},validateForm(){-1===this.email.search(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g)&&(this.validation.emailInvalid=!0),this.password.length<8&&(this.validation.passwordInvalid=!0),this.registrationMode&&(-1===this.name.search(/\w+\s+[A-Z]\.+[A-Z]\./)&&(this.validation.nameInvalid=!0),-1===this.group.search(/[A-za-z][A-za-z]+\-+[0-9][0-9]/)&&(this.validation.groupInvalid=!0),-1===this.phone.search(/((\(\d{3}\) ?)|(\d{3}-))?\-\d{3}-\d{2}-\d{2}/)&&(this.validation.phoneInvalid=!0),-1===this.idCard.search(/[A-Z][A-Z]+\s+\№\d{6}/)&&(this.validation.idInvalid=!0),-1===this.faculty.search(/[A-Z]{4}/)&&(this.validation.facultyInvalid=!0));const e=Object.values(this.validation).findIndex((e=>!0===e));return!(e>=0)},onLogin(){if(this.$store.dispatch("getCurrentUser",this.email),!this.currentUser)return void K()("There is no user with such email. Please register instead");const{password:e,admin:t,userInfo:i}=this.currentUser;e==this.password?(this.$store.dispatch("setAuthentication",{isLoggedIn:!0,admin:t}),t?this.$router.push("/users"):this.$router.push("/info")):K()("Your email or password is wrong. Please try again")},async onRegister(){this.$store.dispatch("getCurrentUser",this.email);const e=this.$store.getters.getCurUser;if(e)return K()("User with this email already exists. Please log in instead"),void(this.registrationMode=!1);const t={email:this.email,password:this.password,admin:!1,userInfo:{name:this.name,group:this.group,phone:this.phone,idCard:this.idCard,faculty:this.faculty}};this.$store.dispatch("createUser",t),this.$store.dispatch("setCurrentUser",t),this.$store.dispatch("setAuthentication",{isLoggedIn:!0,admin:!1}),this.$router.push("/info")}},mounted(){this.$store.dispatch("fetchAllUsers")}};const Q=(0,o.Z)(B,[["render",H],["__scopeId","data-v-93173088"]]);var X=Q;const ee=(0,s._)("div",{class:"title"},[(0,s._)("h2",null,"Ghange your password")],-1),te={key:0},ie={key:1},ne=(0,s._)("button",{type:"submit"},"Submit",-1);function se(e,t,i,r,a,o){return(0,s.wg)(),(0,s.iD)("div",null,[ee,(0,s._)("form",{onSubmit:t[2]||(t[2]=(...e)=>o.onFormSubmit&&o.onFormSubmit(...e))},[(0,s.wy)((0,s._)("input",{type:"text",placeholder:"Current password","onUpdate:modelValue":t[0]||(t[0]=e=>a.oldPassword=e),class:(0,p.C_)(a.passwordInvalid?"invalid":"")},null,2),[[n.nr,a.oldPassword]]),a.passwordInvalid?((0,s.wg)(),(0,s.iD)("p",te," Password has to be at least 8 characters long ")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{type:"text",placeholder:"New password","onUpdate:modelValue":t[1]||(t[1]=e=>a.newPassword=e),class:(0,p.C_)(a.passwordInvalid?"invalid":"")},null,2),[[n.nr,a.newPassword]]),a.passwordInvalid?((0,s.wg)(),(0,s.iD)("p",ie," Password has to be at least 8 characters long ")):(0,s.kq)("",!0),ne],32)])}var re={name:"EditPassword",data(){return{oldPassword:"",newPassword:"",passwordInvalid:!1,user:{}}},created(){this.user=this.$store.getters.getCurUser},methods:{onFormSubmit(e){if(e.preventDefault(),this.oldPassword===this.user.password){if(this.oldPassword===this.newPassword)return K()("New password cannot be same as old");this.$store.dispatch("changePassword",{email:this.user.email,password:this.newPassword}),this.$router.push("/info")}else K()("Your current password is wrong, please try again")}}};const ae=(0,o.Z)(re,[["render",se]]);var oe=ae;const de=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:X},{path:"/users",name:"UserList",component:C,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/edit",name:"EditPassword",component:oe,meta:{requiresAuth:!0}},{path:"/info",name:"UserInfo",component:q,props:!0,meta:{requiresAuth:!0}}],le=(0,h.p7)({history:(0,h.PO)(),routes:de});le.beforeEach(((e,t,i)=>{e.meta.requiresAuth&&!c.getters.isLoggedIn?i("/login"):e.meta.requiresAdmin&&c.getters.isLoggedIn&&!c.getters.isAdmin?(K()("Sorry, you do not have admin rights!"),i("/info")):i()}));var ue=le;(0,n.ri)(l).use(c).use(ue).mount("#app")}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}i.m=e,function(){var e=[];i.O=function(t,n,s,r){if(!n){var a=1/0;for(u=0;u<e.length;u++){n=e[u][0],s=e[u][1],r=e[u][2];for(var o=!0,d=0;d<n.length;d++)(!1&r||a>=r)&&Object.keys(i.O).every((function(e){return i.O[e](n[d])}))?n.splice(d--,1):(o=!1,r<a&&(a=r));if(o){e.splice(u--,1);var l=s();void 0!==l&&(t=l)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[n,s,r]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,r,a=n[0],o=n[1],d=n[2],l=0;if(a.some((function(t){return 0!==e[t]}))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(d)var u=d(i)}for(t&&t(n);l<a.length;l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(u)},n=self["webpackChunkui"]=self["webpackChunkui"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(8660)}));n=i.O(n)})();
//# sourceMappingURL=app.18e41b3b.js.map